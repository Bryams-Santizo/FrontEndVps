<div class="contenedor"> 

    <div class="card-form">

        <h2>Registro de Eventos</h2> 
        
        

        <form (ngSubmit)="guardarEvento()" #eventoForm="ngForm">

            <div class="grid"> 

                <div class="campo campo-full">
                    <div class="label-with-tooltip">
                        <label for="nombre">Nombre del Evento <span class="required">*</span></label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">Título completo con el que se promociona la actividad (ej: "congreso nacional de productividad agrícola").</span>
                        </div>
                    </div>
                    <input type="text" id="nombre" [(ngModel)]="evento.nombreEvento" name="nombreEvento" required placeholder="Ej: Seminario Nacional del Sector Cafetalero">
                </div>

                <div class="campo">
                    <div class="label-with-tooltip">
                        <label for="tipo">Tipo <span class="required">*</span></label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">Clasificación de la actividad (taller, congreso, foro, etc.).</span>
                        </div>
                    </div>
                    <select id="tipo" [(ngModel)]="evento.tipo" name="tipo" required>
                        <option value="" disabled selected>Seleccione...</option>
                        <option *ngFor="let t of tiposEvento" [value]="t">{{ t }}</option>
                    </select>
                </div>

                
                
                <div class="campo">
                    <div class="label-with-tooltip">
                        <label for="fecha">Fecha <span class="required">*</span></label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">Fecha de inicio y finalización del evento.</span>
                        </div>
                    </div>
                    <input type="date" id="fecha" [(ngModel)]="evento.fechaHorario" name="fechaHorario" required>
                </div>

                <div class="campo">
                    <div class="label-with-tooltip">
                        <label for="sede">Sede / Modalidad</label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">Lugar físico o plataforma virtual. (ej: Zoom o Sede Física).</span>
                        </div>
                    </div>
                    <input type="text" id="sede" [(ngModel)]="evento.sede" name="sede" placeholder="Ej: Virtual (Zoom) o Sede Física">
                </div>

                <div class="campo campo-full"> 
                    <div class="label-with-tooltip">
                        <label for="organizador">Organizador Institucional</label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">Nombre de la institución o dependencia principal responsable de la organización.</span>
                        </div>
                    </div>
                    <input type="text" id="organizador" [(ngModel)]="evento.organizador" name="organizador" placeholder="Ej: TecNM Campus Chiapas">
                </div>

                <div class="campo campo-full">
                    <div class="label-with-tooltip">
                        <label for="objetivo">Objetivo del Evento <span class="required">*</span></label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">Describa el propósito principal o el resultado esperado del evento.</span>
                        </div>
                    </div>
                    <textarea id="objetivo" rows="3" [(ngModel)]="evento.objetivo" name="objetivo" required placeholder="Describa el propósito principal y el valor que ofrecerá."></textarea>
                </div>

                <div class="campo campo-full">
                    <div class="label-with-tooltip">
                        <label for="publico">Público Objetivo</label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">A quién está dirigido el evento. (ej: Directivos, Docentes, Estudiantes).</span>
                        </div>
                    </div>
                    <textarea id="publico" rows="2" [(ngModel)]="evento.publicoObjetivo" name="publicoObjetivo" placeholder="Ej: Directivos, Docentes y Estudiantes de los 254 tecnológicos."></textarea>
                </div>

                <div class="campo campo-full">
                    <div class="label-with-tooltip">
                        <label for="programa">Programa / Agenda Detallada</label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">Agenda detallada del evento, incluyendo horarios de las ponencias.</span>
                        </div>
                    </div>
                    <textarea id="programa" rows="4" [(ngModel)]="evento.programa" name="programa" placeholder="Desglose de temas, horarios y sesiones."></textarea>
                </div>

                <div class="campo campo-full">
                    <div class="label-with-tooltip">
                        <label for="ponentes">Ponentes / Facilitadores</label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">Liste los nombres y, si es relevante, el perfil o la institución de los expositores.</span>
                        </div>
                    </div>
                    <textarea id="ponentes" rows="2" [(ngModel)]="evento.ponentes" name="ponentes" placeholder="Listado de nombres y títulos de los expositores."></textarea>
                </div>

                <div class="campo campo-full">
                    <div class="label-with-tooltip">
                        <label for="requisitos">Requisitos de Inscripción / Acceso</label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">Pasos o documentación necesaria para que los asistentes puedan registrarse y participar.</span>
                        </div>
                    </div>
                    <textarea id="requisitos" rows="2" [(ngModel)]="evento.requisitos" name="requisitos" placeholder="Ej: Registro previo en el enlace externo."></textarea>
                </div>

                <div class="campo campo-full">
                    <div class="label-with-tooltip">
                        <label for="materiales">Materiales del Evento (Entregables)</label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">Recursos o documentos que se entregarán a los participantes (ej: memorias, libros, kit de bienvenida).</span>
                        </div>
                    </div>
                    <textarea id="materiales" rows="2" [(ngModel)]="evento.materiales" name="materiales" placeholder="Ej: Constancia digital, Presentación PDF."></textarea>
                </div>

                <div class="campo campo-full">
                    <div class="label-with-tooltip">
                        <label for="enlace">Enlace de la Publicación (URL Externa)</label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">URL de la publicación en redes sociales o sitio oficial del evento para promoción.</span>
                        </div>
                    </div>
                    <input type="url" id="enlace" [(ngModel)]="evento.enlaceExterno" name="enlaceExterno" placeholder="URL de Facebook, Sitio Web Oficial o Enlace de Registro.">
                </div>

                <div class="campo">
                    <div class="label-with-tooltip">
                        <label for="imagen">Imagen Principal (Banner) <span class="required">*</span></label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">Archivo de imagen promocional (Banner).</span>
                        </div>
                    </div>
                    <input type="file" id="imagen" (change)="seleccionarImagen($event)" accept="image/*" name="imagenFile">
                </div>

                <div class="campo">
                    <div class="label-with-tooltip">
                        <label for="documento">Documento Adjunto (Evidencia / PDF)</label>
                        <div class="tooltip-container">
                             <i class="info-icon">?</i>
                             <span class="tooltip-text">Documentos de respaldo o material gráfico (PDF, PPTX) que demuestran la realización.</span>
                        </div>
                    </div>
                    <input type="file" id="documento" (change)="seleccionarDocumento($event)" accept=".pdf, .pptx, .docx" name="documentoFile">
                </div>

            </div>

           <div class="contenedor-btn"> 
                                <button type="submit" class="btn-guardar" [disabled]="!eventoForm.valid">
                    Guardar Evento en el Sistema
                </button>
            </div>
            
        </form>

    </div>

    
</div>


<div class="contenedor" style="padding-top: 0;">
  <div class="card-form">
    <h2>Eventos Registrados</h2>
    
    <div *ngIf="listaEventos.length === 0" class="no-data" style="text-align: center; padding: 20px;">
      <p>No hay eventos registrados en el sistema.</p>
    </div>

    <table class="table" *ngIf="listaEventos.length > 0" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
      <thead>
        <tr style="background-color: #f8f9fa; border-bottom: 2px solid #dee2e6;">
          <th style="padding: 12px; text-align: left;">Evento</th>
          <th style="padding: 12px; text-align: left;">Tipo</th>
          <th style="padding: 12px; text-align: left;">Sede / Lugar</th>
          <th style="padding: 12px; text-align: center; width: 200px;">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let ev of listaEventos" style="border-bottom: 1px solid #eee;">
          <td style="padding: 12px;"><strong>{{ ev.nombre }}</strong></td>
          <td style="padding: 12px;">{{ ev.tipo }}</td>
          <td style="padding: 12px;">{{ ev.lugar }}</td>
          <td style="padding: 12px; text-align: center;">
            <button (click)="abrirModalEdicion(ev)" class="btn-guardar" style="padding: 6px 12px; font-size: 14px; background: #facc15; color: #1a1a1a; margin-right: 5px;">
              Editar
            </button>
            <button (click)="eliminarEvento(ev.id_evento)" class="btn-guardar" style="padding: 6px 12px; font-size: 14px; background: #ef4444;">
              Eliminar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="proyecto-modal-backdrop" *ngIf="mostrarModalEdit">
  <div class="proyecto-modal">
    <div class="modal-header">
      <h3 style="color: white; margin: 0;">Editar Evento: {{ eventoEnEdicion?.nombre }}</h3>
      <button type="button" class="btn-icon" (click)="cerrarModal()">✖</button>
    </div>

    <div class="modal-body" *ngIf="eventoEnEdicion">
      <div class="modal-layout" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        
        <div class="modal-left">
          <div class="soft-card" style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
            <h4 style="margin-top: 0;">Multimedia Actual</h4>
            
            <div style="margin-bottom: 10px; text-align: center;" *ngIf="eventoEnEdicion.rutaImagen">
              <p style="font-size: 12px; color: #666;">Imagen actual:</p>
              <img [src]="URL_ARCHIVOS + eventoEnEdicion.rutaImagen" 
                   style="max-width: 100%; height: 120px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd;">
            </div>

            <div class="form-group" style="margin-bottom: 15px;">
              <label style="display:block; font-weight:bold;">Reemplazar Banner:</label>
              <input type="file" (change)="seleccionarImagen($event)" accept="image/*" style="width: 100%;">
            </div>
            
            <div class="form-group">
              <label style="display:block; font-weight:bold;">Reemplazar Documento (Evidencia):</label>
              <p style="font-size: 12px; color: #003366;" *ngIf="eventoEnEdicion.rutaEvidencia">
                Archivo actual: {{ eventoEnEdicion.rutaEvidencia }}
              </p>
              <input type="file" (change)="seleccionarDocumento($event)" accept=".pdf" style="width: 100%;">
            </div>
          </div>
        </div>

        <div class="modal-right">
          <div class="soft-card" style="background: #f9fafb; padding: 15px; border-radius: 8px;">
            <div class="form-grid" style="display: flex; flex-direction: column; gap: 10px;">
              
              <div class="form-group">
                <label style="font-weight:bold;">Nombre del Evento</label>
                <input type="text" [(ngModel)]="eventoEnEdicion.nombre" style="width: 100%;">
              </div>

              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div class="form-group">
                  <label style="font-weight:bold;">Tipo</label>
                  <select [(ngModel)]="eventoEnEdicion.tipo" style="width: 100%;">
                    <option *ngFor="let t of tiposEvento" [value]="t">{{t}}</option>
                  </select>
                </div>
                <div class="form-group">
                  <label style="font-weight:bold;">Fecha Inicio</label>
                  <input type="date" [(ngModel)]="eventoEnEdicion.fechaInicio" style="width: 100%;">
                </div>
              </div>

              <div class="form-group">
                <label style="font-weight:bold;">Sede / Modalidad</label>
                <input type="text" [(ngModel)]="eventoEnEdicion.lugar" style="width: 100%;">
              </div>

              <div class="form-group">
                <label style="font-weight:bold;">Organizador</label>
                <input type="text" [(ngModel)]="eventoEnEdicion.organizador" style="width: 100%;">
              </div>

              <div class="form-group">
                <label style="font-weight:bold;">Objetivo</label>
                <textarea [(ngModel)]="eventoEnEdicion.objetivo" rows="2" style="width: 100%;"></textarea>
              </div>

              <div class="form-group">
                <label style="font-weight:bold;">Enlace Externo</label>
                <input type="url" [(ngModel)]="eventoEnEdicion.enlaceExterno" style="width: 100%;">
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer" style="padding: 15px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px;">
      <button class="btn-guardar" style="background: #6c757d;" (click)="cerrarModal()">Cancelar</button>
      <button class="btn-guardar" (click)="actualizarEventoTodo()">Guardar Cambios</button>
    </div>
  </div>
</div>