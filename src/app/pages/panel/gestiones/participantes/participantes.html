<div class="container mt-4">
  <div class="card shadow-sm mb-5">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h3 class="mb-0">{{ editMode ? 'Editar Participante' : 'Registrar Nuevo Participante' }}</h3>
      <span class="badge bg-light text-primary">Panel Administrativo</span>
    </div>
    <div class="card-body bg-light">
      <div class="soft-card mb-4">
        <h4>Datos de la Institución / Entidad</h4>
        <div class="form-grid">
          <div class="form-group full-width">
            <label>Nombre Completo</label>
            <input type="text" [(ngModel)]="nuevoParticipante.nombre" class="form-control" placeholder="">
          </div>
          <div class="form-group">
            <label>Tipo de Participante</label>
            <select class="form-select" [(ngModel)]="nuevoParticipante.tipo">
              <option value="TECNOLOGICO">Tecnológico</option>
              <option value="EMPRESA">Empresa</option>
              <option value="GOBIERNO">Gobierno</option>
              <option value="ORGANIZACION">Organización</option>
            </select>
          </div>
          <div class="form-group">
            <label>Teléfono</label>
            <input type="text" [(ngModel)]="nuevoParticipante.telefono" class="form-control" placeholder="">
          </div>
        </div>
      </div>

      <div class="soft-card mb-4" *ngIf="!editMode">
        <h4>Credenciales de Acceso</h4>
        <div class="form-grid">
          <div class="form-group">
            <label>Correo Electrónico </label>
            <input type="email" [(ngModel)]="nuevoParticipante.correo" class="form-control">
          </div>
          <div class="form-group">
            <label>Contraseña Inicial</label>
            <input type="password" [(ngModel)]="nuevoParticipante.password" class="form-control">
          </div>
        </div>
      </div>

      <div class="col-md-6 mb-3">
  <label class="form-label fw-bold">Asignar Nivel de Acceso (Rol)</label>
  <select class="form-select border-primary" [(ngModel)]="nuevoParticipante.rolId" name="rolId" required>
    <option [ngValue]="null" disabled>Selecciona un Rol</option>
    <option *ngFor="let r of roles" [value]="r.id">
      {{ r.nombre }}
    </option>
  </select>
</div>

      <div class="soft-card mb-4">
        <h4>Ubicación</h4>
        <div class="form-grid">
          <div class="form-group">
            <label>Estado</label>
            <input type="text" [(ngModel)]="nuevoParticipante.estado" class="form-control">
          </div>
          <div class="form-group">
            <label>Ciudad</label>
            <input type="text" [(ngModel)]="nuevoParticipante.ciudad" class="form-control">
          </div>
        </div>
      </div>

      <div class="d-flex justify-content-end gap-2">
        <button *ngIf="editMode" class="btn btn-secondary" (click)="cancelarEdicion()">Cancelar Edición</button>
        <button class="btn btn-primary px-5" (click)="guardarParticipante()">
          {{ editMode ? 'Actualizar Datos' : 'Guardar y Crear Acceso' }}
        </button>
      </div>
    </div>
  </div>

  <hr>

  <div class="mt-4">
  <h4 class="mb-3">Participantes Registrados</h4>
  <div class="table-responsive shadow-sm border rounded">
    <table class="table table-hover mb-0">
      <thead class="table-dark">
        <tr>
          <th>Nombre / Institución</th>
          <th>Tipo</th>
          <th>Correo</th>
          <th>Estado / Ciudad</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of participantes">
          <td>
            <strong>{{ p.tecnologico?.nombre || p.empresa?.nombre || p.nombre }}</strong>
          </td>

          <td>
            <span [class]="'badge ' + getBadgeClass(p.tipo)">{{ p.tipo }}</span>
          </td>

          <td>{{ p.tecnologico?.correo || p.empresa?.correo || p.correo }}</td>

          <td>
            {{ p.tecnologico?.estado || p.estado || 'Chiapas' }} 
            <small class="text-muted" *ngIf="p.tecnologico?.ciudad || p.ciudad">
              ({{ p.tecnologico?.ciudad || p.ciudad }})
            </small>
          </td>

          <td class="text-center">
            <button class="btn btn-sm btn-outline-warning me-2" (click)="prepararEdicion(p)">
              <i class="fas fa-edit"></i> Editar
            </button>
            <button class="btn btn-sm btn-outline-danger" (click)="eliminarParticipante(p.id)">
              <i class="fas fa-trash"></i> Eliminar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
</div>